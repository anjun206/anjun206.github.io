# 9.9 동적 메모리 할당

동적 메모리 할당이 뭐하는 지랑 명시적 할당기, 묵시적 할당기에 대해 얘기한다

- **명시적 할당기:**

    - `malloc`패키지 같은 거 말한다

    - 응용이 명시적으로 할당된 블록을 반환해 줄 것을 요구한다

<br>

- **묵시적 할당기:**

    - 가비지 컬렉터 같은거다

    - 할당된 블록이 언제부터 사용 안되고 블록이 반환되는지 검출을 요구한다

<br>

<br>

## 9.9.1 `malloc`과 `free`함수

`malloc` 함수는 32비트에선 8의 배수인 블록 리턴한다

64 비트에서는 16 배수로 리턴하고 말이다

<br>

`malloc`은 문제 발생시 NULL 반환하고 errno[^1] 설정한다

`malloc`은 리턴하는 메모리 초기화하지도 않는다
<br>
따로 메모리 초기화 해주거나 `calloc` 써야 한다
<br>
`calloc`은 리턴시 메모리 초기화 해준다
<br>
`realloc`은 할당된 메모리 크기 변경용이다

<br>

`sbrk` 함수라는 것도 나온다

`sbrk` 함수는 커널의 `brk` 포인터에 `incr`을 더해서 힙을 늘리거나 줄인다
<br>
성공시 이전의 `brk`값 리턴, 아니면 `-1` 리턴하고 errno를 ENOMEM으로 설정한단다
<br>
`incr`이 0이면 걍 현재 `brk`값 이턴하고

음수도 `incr`로 가능하지만 복잡해 진다고 한다

<br>

`free` 함수를 사용할 때에는 할당된 블록의 시작을 가리켜야 함
<br>
아니면 작동안하는데 이놈은 작동안해도 아무말 없어서 눈치채기 어렵다

<br><br><br>

## 9.9.2 왜 동적 메모리 할당인가?

메모리가 얼마나 필요한지 모르는 경우 있어서 쓴다 ㅇㅇ

<br><br>

## 9.9.3 할당기 요구사항과 목표

명시적 할당기는 제한이 걸려있다

### 제한사항

- 임의의 요청 순서 처리하기

    - 어느때나 요청 처리 가능해야 한다

    - 어느 순서에만 받고 이런 거 없다

- 요청에 즉시 응답하기

    - ~~어떤 종류의 데이터 객체라도 저장 가능하게 정렬해야 한다~~

    - 요청의 순서를 바꾸거나, 요청을 버퍼에 모아 두는 등의 재정렬/지연 처리는 허용되지 않는다

- 힙만 사용하기

    - 자료 구조들은 힙 자체에 저장해야만 한다

- 블록 정렬하기

    - 어떤 종류의 데이터...? 뭐야 시발 요청에 즉시 응답하기랑 왜 똑같은 내용이야

    - CSAPP 번역 오륜가 보다 ㄹㅇ 얼탱이 없네 돈받고 뭐하냐?

    - 어떤 종류의 데이터 객체라도 저장 가능하게 정렬해야 한다

    - 여기가 어디든 상관없이 정렬이다

- 할당된 블록을 수정하지 않기

    - 한번 할당된 블록으 수정하거나 이동시키면 안된다 압축도 금지다

<br>

### 목표

1. 처리량 극대화하기

뭐, 당연한거다<br>
많이 처리해야 이득일테니까

2. 메모리 이용도를 최대화하기

이것도 당연한 것 같다<br>
자원은 유한하니까 말이다

<br><br>

## 9.9.4 단편화

단편화에 대해 나온다

대강 말하자면 블록 효율적으로 못쓰는 현상이라 보면 된다

[TIL](../learn/08_1/TIL_0822.md#단편화와-메모리-활용-효율)에 정리했다

<br><br>

## 9.9.5 구현 이슈






<br><br><br><br>

___

[^1]: errno: 시스템/라이브러리 호출이 실패했을 때 그 원인을 나타내도록 설정되는 스레드별 전역 오류 코드 변수

