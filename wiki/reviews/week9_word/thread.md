# Thread (스레드)

- **정의:**<br>
CPU에 실제로 **스케줄되는 실행 단위**<br>
같은 프로세스의 스레드끼리는 **주소 공간과 자원 공유**

<br>

## TCB (Thread Control Block)

[PCB](process.md#pcb-process-control-block)의 스레드 버전이다

(스레드 메타데터 묶음이란 뜻)


### 공통(개념적으로 필수)

- **ID:** `tid` (스레드 식별자)

- **상태:** `READY / RUNNING / BLOCKED / DYING`

- **스케줄링 정보:** `priority`(우선순위), 러닝타임/타임슬라이스 통계

- **컨텍스트 저장 위치:** 스위치 시점의 **커널 스택 상 프레임**과 TCB의 일부 필드

- **큐 연결고리:** 레디 큐, 대기(sema/lock) 큐에 들어갈 **list node**

- **커널 스택 포인터:** 현재 스레드의 **커널 스택 최상단 지시자**

- **디버깅/가드:** 스택 오버플로 감지용 `magic` 값 등

<br>

## 커널 스택, 유저 스택

둘 다 스택이다

스택은 힙처럼 메모리 영역 쓰지만 좀 다르다

- **스택:** <br>
스레드 생성 시 OS/런타임이 **스레드별**로 영역을 예약(+가드 페이지[^1]) 함수 호출/리턴에 따라 자동으로 push/pop

- **힙:** <br>
프로세스 전체에 1개. malloc/free(또는 new/delete) 같은 **명시적 호출**로 관리

___

### 커널 스택

```diff
+-------------------------+  높은 주소
|  커널 스택 (아래로 성장)  |
|          ...            |
|   saved context frames  |  ← 컨텍스트 스위치 시 push되는 곳
+-------------------------+
|      struct thread      |  ← TCB, magic이 여기 있음
+-------------------------+  낮은 주소   (4KiB 한 페이지)
```


### 유저 스택




<br><br><br>

___

<br>

[^1]: “접근 금지”로 표시해 둔 메모리 페이지 <br>
보통 스택 끝에 붙여둬 스택 넘치는 거 관리한다